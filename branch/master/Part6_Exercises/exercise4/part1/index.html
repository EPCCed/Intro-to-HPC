<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Traffic model simulation: Serial Execution &mdash; Introduction to HPC  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/epcc_logo.svg"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" />
    <link rel="next" title="Traffic model simulation: Threaded computation" href="../part2/" />
    <link rel="prev" title="Practical exercise 4: Traffic simulation" href="../" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../" class="icon icon-home"> Introduction to HPC
            <img src="../../../_static/epcc_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Part0_Introduction/contents/">Introduction to High Performance Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Part1_Supercomputing/contents/">Supercomputing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Part2_Parallel_Computers/contents/">Parallel Computers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Part3_Parallel_Computing/contents/">Parallel Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Part4_Computer_Simulations/contents/">Computer Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Part5_Case_Studies/contents/">Case Studies</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../contents/">Exercises</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../exercise0/">Practical exercise 0: First use of HPC machine, Hello World!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercise1/">Practical exercise 1: First use of HPC machine, Image sharpening code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercise2/">Practical exercise 2: Parallel worksharing, Fractal code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../exercise3/">Pratical exercise 3: Investigating parallel performance, GROMACS</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../">Practical exercise 4: Traffic simulation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Traffic model simulation: Serial Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#downloading-the-source-code">Downloading the source code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-the-environment">Setting the Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-the-source-code">Compiling the source code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-serial-code">Running the serial code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../part2/">Traffic model simulation: Threaded computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part3/">Traffic model simulation: Message passing computation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Introduction to HPC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../contents/">Exercises</a></li>
          <li class="breadcrumb-item"><a href="../">Practical exercise 4: Traffic simulation</a></li>
      <li class="breadcrumb-item active">Traffic model simulation: Serial Execution</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/JPRichings/content/blob/main/content/Part6_Exercises/exercise4/part1.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="traffic-model-simulation-serial-execution">
<h1>Traffic model simulation: Serial Execution<a class="headerlink" href="#traffic-model-simulation-serial-execution" title="Permalink to this headline"></a></h1>
<p>As just discussed the aim of this simulation is to understand how traffic density has an effect on average traffic speed.</p>
<section id="downloading-the-source-code">
<h2>Downloading the source code<a class="headerlink" href="#downloading-the-source-code" title="Permalink to this headline"></a></h2>
<p>In this exercise we will be using the traffic simulaion program. The source code is available in the same Github repository as the other examples.</p>
<p>To download the code you will need to clone the repository. To do this execute the following command</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">EPCCed</span><span class="o">/</span><span class="n">EPCC</span><span class="o">-</span><span class="n">Exercises</span>
</pre></div>
</div>
</div></blockquote>
<p>The output will look similar to this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">Cloning</span> <span class="n">into</span> <span class="s1">&#39;EPCC-Exercises&#39;</span><span class="o">...</span>
    <span class="n">remote</span><span class="p">:</span> <span class="n">Enumerating</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="n">done</span><span class="o">.</span>
    <span class="n">remote</span><span class="p">:</span> <span class="n">Counting</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="mi">21</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
    <span class="n">remote</span><span class="p">:</span> <span class="n">Compressing</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">15</span><span class="o">/</span><span class="mi">15</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>
    <span class="n">remote</span><span class="p">:</span> <span class="n">Total</span> <span class="mi">21</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">7</span><span class="p">),</span> <span class="n">reused</span> <span class="mi">16</span> <span class="p">(</span><span class="n">delta</span> <span class="mi">5</span><span class="p">),</span> <span class="n">pack</span><span class="o">-</span><span class="n">reused</span> <span class="mi">0</span>
    <span class="n">Receiving</span> <span class="n">objects</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">21</span><span class="o">/</span><span class="mi">21</span><span class="p">),</span> <span class="mf">314.18</span> <span class="n">KiB</span> <span class="o">|</span> <span class="mf">2.51</span> <span class="n">MiB</span><span class="o">/</span><span class="n">s</span><span class="p">,</span> <span class="n">done</span><span class="o">.</span>
    <span class="n">Resolving</span> <span class="n">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="mi">7</span><span class="p">),</span> <span class="n">done</span><span class="o">.</span>

</pre></div>
</div>
<p>You will now have a folder called <code class="docutils literal notranslate"><span class="pre">traffic</span></code>. Change directory into it and list the contents</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">cd</span> <span class="n">EPCC</span><span class="o">-</span><span class="n">Exercises</span><span class="o">/</span><span class="n">traffic</span><span class="o">/</span><span class="n">C</span>
   <span class="n">ls</span>
</pre></div>
</div>
</div></blockquote>
<p>Output</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">C</span><span class="o">-</span><span class="n">MPI</span>  <span class="n">C</span><span class="o">-</span><span class="n">OMP</span>  <span class="n">C</span><span class="o">-</span><span class="n">SER</span>
</pre></div>
</div>
<p>There are several version of the code, a serial version and a number of parallel versions. Initially we will be looking at the serial version located in the <code class="docutils literal notranslate"><span class="pre">C-SER</span></code> folder.</p>
</section>
<section id="setting-the-environment">
<h2>Setting the Environment<a class="headerlink" href="#setting-the-environment" title="Permalink to this headline"></a></h2>
<p>Before compiling the source code for the example make sure that the relivant environment scripts has been sourced to set the correct environment parameters for compiling on this machine.</p>
<p>For example of Machine ARCHER2,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">source</span> <span class="n">EPCC</span><span class="o">-</span><span class="n">Exercises</span><span class="o">/</span><span class="n">Env</span><span class="o">/</span><span class="n">env</span><span class="o">-</span> <span class="p">{{</span> <span class="n">machine_name</span> <span class="p">}}</span> <span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>This makes sure that each example compiles for the system you are using to run the examples.</p>
</section>
<section id="compiling-the-source-code">
<h2>Compiling the source code<a class="headerlink" href="#compiling-the-source-code" title="Permalink to this headline"></a></h2>
<p>We will compile the serial version of the source code using a Makefile.</p>
<p>Move into the <code class="docutils literal notranslate"><span class="pre">C-SER</span></code> directory and list the contents.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">cd</span> <span class="n">C</span><span class="o">-</span><span class="n">SER</span>
   <span class="n">ls</span>
</pre></div>
</div>
</div></blockquote>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">traffic</span><span class="o">.</span><span class="n">c</span>  <span class="n">traffic</span><span class="o">.</span><span class="n">h</span>  <span class="n">trafficlib</span><span class="o">.</span><span class="n">c</span>  <span class="n">uni</span><span class="o">.</span><span class="n">c</span>  <span class="n">uni</span><span class="o">.</span><span class="n">h</span>  <span class="n">Makefile</span>
</pre></div>
</div>
<p>You will see that there are various code files. The Makefile contains the commands to compile them together to produce the executable program. To use the Makefile type <code class="docutils literal notranslate"><span class="pre">make</span></code> command.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   make
</pre></div>
</div>
</div></blockquote>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">O3</span> <span class="o">-</span><span class="n">c</span> <span class="n">traffic</span><span class="o">.</span><span class="n">c</span>
<span class="n">cc</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">O3</span> <span class="o">-</span><span class="n">c</span> <span class="n">trafficlib</span><span class="o">.</span><span class="n">c</span>
<span class="n">cc</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">O3</span> <span class="o">-</span><span class="n">c</span> <span class="n">uni</span><span class="o">.</span><span class="n">c</span>
<span class="n">cc</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">O3</span> <span class="o">-</span><span class="n">o</span> <span class="n">traffic</span> <span class="n">traffic</span><span class="o">.</span><span class="n">o</span> <span class="n">trafficlib</span><span class="o">.</span><span class="n">o</span> <span class="n">uni</span><span class="o">.</span><span class="n">o</span> <span class="o">-</span><span class="n">lm</span>
</pre></div>
</div>
<p>This should produce an executable file called <code class="docutils literal notranslate"><span class="pre">traffic</span></code>.</p>
</section>
<section id="running-the-serial-code">
<h2>Running the serial code<a class="headerlink" href="#running-the-serial-code" title="Permalink to this headline"></a></h2>
<p>We can run the serial program directly on the login nodes</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="o">./</span><span class="n">traffic</span> <span class="mf">0.52</span>
</pre></div>
</div>
</div></blockquote>
<p>The argument is setting the target traffic density of cars for the model.</p>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Length</span> <span class="n">of</span> <span class="n">road</span> <span class="ow">is</span> <span class="mi">32000000</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="ow">is</span> <span class="mi">100</span>
<span class="n">Target</span> <span class="n">density</span> <span class="n">of</span> <span class="n">cars</span> <span class="ow">is</span> <span class="mf">0.520000</span>
<span class="n">Initialising</span> <span class="n">road</span> <span class="o">...</span>
<span class="o">...</span><span class="n">done</span>
<span class="n">Actual</span> <span class="n">density</span> <span class="n">of</span> <span class="n">cars</span> <span class="ow">is</span> <span class="mf">0.519982</span>

<span class="n">At</span> <span class="n">iteration</span> <span class="mi">10</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.789461</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">20</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.837157</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">30</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.858209</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">40</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.870573</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">50</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.878940</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">60</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.885087</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">70</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.889761</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">80</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.893441</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">90</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.896447</span>
<span class="n">At</span> <span class="n">iteration</span> <span class="mi">100</span> <span class="n">average</span> <span class="n">velocity</span> <span class="ow">is</span> <span class="mf">0.898955</span>

<span class="n">Finished</span>

<span class="n">Time</span> <span class="n">taken</span> <span class="n">was</span>  <span class="mf">11.418155</span> <span class="n">seconds</span>
<span class="n">Update</span> <span class="n">rate</span> <span class="n">was</span> <span class="mf">280.255431</span> <span class="n">MCOPs</span>
</pre></div>
</div>
<p>The result we are interested in this the final avarge verlocity that is reported at iteration 100.</p>
<p>Run this example with multiple different values of the Target density and see how your results compare to the plot relating traffic density to average verlocity from the section on the traffic model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../" class="btn btn-neutral float-left" title="Practical exercise 4: Traffic simulation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../part2/" class="btn btn-neutral float-right" title="Traffic model simulation: Threaded computation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, EPCC at the University of Edinburgh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>